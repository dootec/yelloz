#!/bin/bash

action=$1
confir=$2

welcome () {
	clear
	printf "\n***** Bluetooth Booster | yelloz *****\n\n"
	printf "Master: https://github.com/dootec\n"
	printf "Exerimental Version: 1.0.0-e\n\n"
	printf "Enter a number to select the action:\n"
	printf "\n\t[1] : Improve Bluetooth Power With Bluez5\n\t[2] : Reset to default setting\n\n"
}

install () {
	sudo apt update
	sudo add-apt-repository ppa:bluetooth/bluez -y
	sudo apt update
	sudo apt install bluez -y
	sudo apt install blueman -y
	sudo apt install pulseaudio -y
	sudo apt update
	sudo sed -i 's/.ifexists module-bluetooth-discover.so/.ifexists module-bluez5-discover.so/g' /etc/pulse/default.pa
	sudo sed -i 's/load-module module-bluetooth-discover/load-module module-bluez5-discover/g' /etc/pulse/default.pa
	sudo sed -i 's/#IdleTimeout=30/IdleTimeout=0/g' /etc/bluetooth/input.conf
	sudo sed -i 's/#UserspaceHID=true/UserspaceHID=true/g' /etc/bluetooth/input.conf
	echo ""
	echo "Installation is successfully."
	echo "Now, you have to reboot your computer."
	echo ""
	echo "Have a nice day."
	echo ""
}


uninstall () {
	sudo sed -i 's/.ifexists module-bluez5-discover.so/.ifexists module-bluetooth-discover.so/g' /etc/pulse/default.pa
	sudo sed -i 's/load-module module-bluez5-discover/load-module module-bluetooth-discover/g' /etc/pulse/default.pa
	sudo sed -i 's/IdleTimeout=0/#IdleTimeout=30/g' /etc/bluetooth/input.conf
	sudo sed -i 's/UserspaceHID=true/#UserspaceHID=true/g' /etc/bluetooth/input.conf
	echo ""
	echo "Uninstallation is successfully."
	echo "Now, you have to reboot your computer."
	echo ""
	echo "Have a nice day."
	echo ""
}

doYouApproveTheInstallation () {
	read -p "Do you approve the installation? (Y/n) : " confir
	if [[ $confir == "y" ]]; then
		echo "Installation is begin."
		install
	else
		echo "No action taken, good day."
	fi
}

doYouApproveTheUninstallation () {
	read -p "Do you approve the uninstallation? (Y/n) : " confir
	if [[ $confir == "y" ]]; then
		echo "Uninstallation is begin."
		uninstall
	else
		echo "No action taken, good day."
	fi
}

yelloz () {
	if [[ $action == "" ]] && [[ $confir == "" ]]; then
		welcome
		read -p "Pick a number (1/2) : " action
		if [[ $action == "1" ]]; then
			doYouApproveTheInstallation
		elif [[ $action == "2" ]]; then
			doYouApproveTheUninstallation
		else
			echo "No action taken, good day."
		fi
	else
		if [[ $action == "1" ]]; then
			if [[ $confir == "-y" ]]; then
				echo "Quick mode is on, installation is begin."
				install
			else
				doYouApproveTheInstallation
			fi
		elif [[ $action == "2" ]]; then
			if [[ $confir == "-y" ]]; then
				echo "Quick mode is on, uninstallation is begin."
				uninstall
			else
				doYouApproveTheUninstallation
			fi
		else
			echo "No action taken, good day."
		fi
	fi
}

yelloz

